# Render Deployment Guide

This guide will help you deploy your Java Spring Boot Finance Tracker application to Render.

## Why Render?

- **Generous Free Tier**: Free tier includes 750 hours/month (enough for 24/7 operation)
- **PostgreSQL Database**: Free PostgreSQL database included
- **Automatic HTTPS**: SSL certificates provided automatically
- **Easy Deployment**: Simple Git-based deployment
- **Custom Domains**: Free custom domain support

## Prerequisites

1. **Render Account**: Sign up at [render.com](https://render.com)
2. **Git Repository**: Your code should be in a Git repository (GitHub, GitLab, etc.)

## Step 1: Prepare Your Repository

Your repository should now contain:
- ✅ `Dockerfile` - For containerizing the application
- ✅ `render.yaml` - Render configuration
- ✅ `.dockerignore` - Excludes unnecessary files
- ✅ `application-render.yml` - Render-specific configuration
- ✅ `HealthController.java` - Health check endpoint

## Step 2: Deploy to Render

### Option A: Deploy via Render Dashboard (Recommended)

1. **Go to Render Dashboard**
   - Visit [render.com](https://render.com)
   - Sign in with your account

2. **Create New Web Service**
   - Click "New +"
   - Select "Web Service"
   - Connect your GitHub account if not already connected
   - Select your repository

3. **Configure the Service**
   - **Name**: `finance-tracker-api`
   - **Environment**: `Docker`
   - **Region**: Choose closest to your users
   - **Branch**: `main` (or your default branch)
   - **Build Command**: `./mvnw clean package -DskipTests`
   - **Start Command**: `java -jar target/finance-tracker-0.0.1-SNAPSHOT.jar`

4. **Add PostgreSQL Database**
   - In your dashboard, click "New +"
   - Select "PostgreSQL"
   - **Name**: `finance-tracker-db`
   - **Database**: `finance_tracker`
   - **User**: `finance_tracker_user`
   - **Plan**: Free

5. **Link Database to Web Service**
   - Go back to your web service
   - Click "Environment"
   - Add the following environment variables:
     - `DATABASE_URL` (copy from PostgreSQL service)
     - `DB_USERNAME` = `finance_tracker_user`
     - `DB_PASSWORD` (copy from PostgreSQL service)
     - `JWT_SECRET` (generate a secure random string)
     - `JWT_EXPIRATION` = `86400000`
     - `ADMIN_USERNAME` = `admin`
     - `ADMIN_PASSWORD` (generate a secure password)
     - `SPRING_PROFILES_ACTIVE` = `render`

6. **Deploy**
   - Click "Create Web Service"
   - Render will automatically build and deploy your application

### Option B: Deploy using render.yaml (Blueprints)

1. **Push your code with render.yaml**
   - Ensure `render.yaml` is in your repository root
   - Push to your Git repository

2. **Deploy via Blueprint**
   - Go to [render.com](https://render.com)
   - Click "New +"
   - Select "Blueprint"
   - Connect your repository
   - Render will automatically create both the web service and database

## Step 3: Configure Environment Variables

### Required Environment Variables

| Variable | Description | Source | Default |
|----------|-------------|---------|---------|
| `DATABASE_URL` | PostgreSQL connection URL | Auto-generated by Render | `jdbc:postgresql://localhost:5432/finance_tracker` |
| `DB_USERNAME` | Database username | Auto-generated by Render | `finance_tracker_user` |
| `DB_PASSWORD` | Database password | Auto-generated by Render | `password` |
| `JWT_SECRET` | JWT signing secret | Set in render.yaml | `finance-tracker-jwt-secret-key-2024-super-secure-and-long-enough-for-production-use` |
| `JWT_EXPIRATION` | JWT expiration time (ms) | Set in render.yaml | `86400000` |
| `ADMIN_USERNAME` | Admin username | Set in render.yaml | `admin` |
| `ADMIN_PASSWORD` | Admin password | Set in render.yaml | `admin123` |
| `SPRING_PROFILES_ACTIVE` | Spring profile | Set in render.yaml | `render` |
| `PORT` | Application port | Auto-set by Render | `8080` |

### Generating Secure Values

**JWT Secret** (64+ characters):
```bash
# Generate a secure JWT secret
openssl rand -base64 64
```

**Admin Password** (12+ characters):
```bash
# Generate a secure admin password
openssl rand -base64 12
```

## Step 4: Verify Deployment

1. **Check Build Logs**
   - Monitor the build process in Render dashboard
   - Ensure the Docker build completes successfully

2. **Test Health Endpoint**
   - Once deployed, your app will be available at: `https://your-app-name.onrender.com`
   - Test the health endpoint: `https://your-app-name.onrender.com/api/health`

3. **Test API Endpoints**
   - Swagger UI: `https://your-app-name.onrender.com/api/swagger-ui.html`
   - API Documentation: `https://your-app-name.onrender.com/api/api-docs`

## Step 5: Custom Domain (Optional)

1. **Add Custom Domain**
   - In your web service, go to "Settings"
   - Click "Custom Domains"
   - Add your domain
   - Configure DNS as instructed

## Step 6: Monitor and Scale

### Free Tier Limits
- **Web Services**: 750 hours/month
- **PostgreSQL**: 1GB storage, 90 days retention
- **Bandwidth**: 100GB/month

### Monitoring
- **Logs**: Available in the Render dashboard
- **Metrics**: Basic metrics provided
- **Health Checks**: Automatic health monitoring

## Recent Fixes

### Environment Variable Issues (Fixed)
- **JWT_SECRET**: Added default value and explicit configuration in render.yaml
- **Database credentials**: Added fallback values for local development
- **Admin credentials**: Set explicit values in render.yaml
- **All environment variables**: Now have proper default values

### Security Improvements
- **JWT Secret**: Now uses a secure, long secret key
- **Admin Password**: Set to a secure default value
- **Database Password**: Has fallback for development

## Troubleshooting

### Common Issues

1. **Build Fails**
   - Check if all files are committed to Git
   - Verify Dockerfile syntax
   - Check build logs for specific errors

2. **Database Connection Issues**
   - Verify `DATABASE_URL` is correctly set
   - Ensure database service is running
   - Check if database credentials are correct

3. **Application Won't Start**
   - Check application logs in Render dashboard
   - Verify all required environment variables are set
   - Ensure health check endpoint is accessible

4. **Port Issues**
   - Render automatically sets the `PORT` environment variable
   - Your application should use `System.getenv("PORT")` or the `PORT` variable

### Logs and Debugging

- **View Logs**: Go to your service → "Logs" tab
- **Real-time Logs**: Available during deployment
- **Health Checks**: Render checks `/api/health` endpoint

## Security Considerations

1. **JWT Secret**: Use a strong, random JWT secret in production
2. **Database Credentials**: Render automatically manages database credentials
3. **Environment Variables**: Never commit sensitive data to your repository
4. **HTTPS**: Render automatically provides HTTPS for all deployments

## Cost Optimization

### Free Tier Benefits
- **750 hours/month**: Enough for 24/7 operation
- **1GB PostgreSQL**: Sufficient for development/small apps
- **100GB bandwidth**: Good for moderate traffic

### When to Upgrade
- Exceed 750 hours/month
- Need more than 1GB database storage
- Require more bandwidth
- Need better performance

## Support

- **Render Documentation**: [docs.render.com](https://docs.render.com)
- **Render Community**: [community.render.com](https://community.render.com)
- **GitHub Issues**: For application-specific issues

## Migration from Railway

If you're migrating from Railway:

1. **Export Environment Variables**: Copy all environment variables from Railway
2. **Update Configuration**: Use `application-render.yml` instead of `application-prod.yml`
3. **Deploy to Render**: Follow the deployment steps above
4. **Update DNS**: Point your custom domain to Render
5. **Test Thoroughly**: Ensure all functionality works on Render
6. **Shutdown Railway**: Once confirmed working, stop Railway services

## Next Steps

After successful deployment:

1. **Set up CI/CD**: Configure automatic deployments on Git push
2. **Add Monitoring**: Set up external monitoring (optional)
3. **Backup Strategy**: Configure database backups
4. **Performance Optimization**: Monitor and optimize as needed
